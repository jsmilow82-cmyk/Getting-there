<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lesson 2 ‚Äî The Mix-Up (Listening + Exercises)</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.5;margin:0;background:#fff;}
  .app{max-width:980px;margin:0 auto;padding:18px;}
  .card{border:1px solid #e3e3e3;border-radius:16px;padding:18px;margin:14px 0;}
  h1{margin:0 0 6px;font-size:26px;}
  .sub{margin:0 0 14px;opacity:.75;}
  audio{width:100%;margin:10px 0 6px;}

  .controls{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 12px;align-items:center;}
  button{padding:10px 14px;font-size:14px;border-radius:10px;border:1px solid #bbb;background:#fff;cursor:pointer;}
  button:hover{background:#f6f6f6;}
  .hidden{display:none;}

  .prompt{margin:6px 0 12px;font-size:16px;}
  .options{display:grid;gap:8px;margin-top:8px;}
  label{display:flex;gap:8px;align-items:flex-start;cursor:pointer;}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}

  input[type="text"]{width:260px;padding:8px 10px;border:1px solid #bbb;border-radius:10px;font-size:15px;}
  select{padding:8px 10px;border:1px solid #bbb;border-radius:10px;font-size:15px;}

  .feedback{margin-top:12px;padding:12px;border-radius:12px;border:1px solid #ddd;display:none;}
  .feedback.good{border-color:#7cc47c;}
  .feedback.bad{border-color:#e07a7a;}
  .note{margin-top:8px;font-size:14px;opacity:.8;}

  /* Transcript */
  .dialogueArea{margin-top:8px;}
  .line{opacity:0;transform:translateY(4px);transition:opacity 200ms ease,transform 200ms ease;margin:4px 0;padding:0;border:none;box-shadow:none;background:transparent;}
  .line.visible{opacity:1;transform:translateY(0);}
  .line.past{opacity:.6;}
  .line.current{opacity:1;padding-left:10px;border-left:3px solid #ddd;}
  .speaker{font-weight:800;margin-right:6px;}
  .maria .speaker{color:#1f4e79;}
  .dave .speaker{color:#6a1b9a;}

  /* Prevent weird thin lines inside transcript */
  .dialogueArea,.dialogueArea *{border-top:none!important;border-bottom:none!important;box-shadow:none!important;background-image:none!important;}
  .dialogueArea hr{display:none!important;}
</style>
</head>
<body>
<div class="app" id="app"></div>

<script>
(() => {
  const uid = "l2_" + Math.random().toString(16).slice(2);

  // Put lesson-02.mp3 in the SAME folder as this index.html
  const mp3 = "lesson-02.mp3";
const TIME_SCALE = 0.90;   // < 1 makes transcript happen earlier (audio is ahead)
const TIME_OFFSET = 0.00;  // seconds; use -0.5 if it‚Äôs still a bit late everywhere
const T = (t) => (t * TIME_SCALE) + TIME_OFFSET;

  // ‚úÖ Removed the ‚Äútries to open the door‚Äù line
  // ‚úÖ Shifted all later timestamps earlier to keep alignment (edit as needed)
  const dialogueLines = [
    { t: 0.0,  speaker: "Maria", cls:"maria", text: "1-2-3-4?! How stupid!" },
    { t: 4.5,  speaker: "Maria", cls:"maria", text: "(in Russian) Come on you stupid door; open!" },
    { t: 8.5,  speaker: "Dave",  cls:"dave",  text: "Hey!" },
    { t: 10.5, speaker: "Maria", cls:"maria", text: "Oh my god! Don‚Äôt hurt me!" },
    { t: 14.5, speaker: "Dave",  cls:"dave",  text: "What? I‚Äôm not going to hurt you, I just want to know why you‚Äôre trying to break into my apartment." },
    { t: 23.0, speaker: "Maria", cls:"maria", text: "Your apartment?! Oh, there must be some mix up. Um, I‚Äôm looking for my Air B&B. It‚Äôs 1026 Manhattan Avenue. Am I at the right place?" },
    { t: 36.0, speaker: "Dave",  cls:"dave",  text: "You sure are. But you must be looking for 1026 A, this is 1026 B. You‚Äôre just next door." },
    { t: 46.0, speaker: "Maria", cls:"maria", text: "Oh thanks. Sorry, this must be your door then, haha. What a funny thing to happen: you thought I was trying to break in and rob your place and I thought you were going to mug me." },
    { t: 62.0, speaker: "Dave",  cls:"dave",  text: "Haha, yeah. Nope I‚Äôm just your new neighbor. Anyway, do I look like someone who goes around mugging people?" },
    { t: 71.0, speaker: "Maria", cls:"maria", text: "Well, I don‚Äôt know. I‚Äôve never been mugged before so‚Ä¶ Do I look like someone who breaks into people‚Äôs houses?" },
    { t: 80.0, speaker: "Dave",  cls:"dave",  text: "No! I mean, no, of course not. Actually you look really‚Ä¶um, yeah." },
    { t: 88.0, speaker: "Maria", cls:"maria", text: "Anyway, speaking of crime; Is this neighborhood safe?" },
    { t: 94.0, speaker: "Dave",  cls:"dave",  text: "Yeah. I know some buildings look a little run-down, but it‚Äôs actually a really safe neighborhood." },
    { t: 101.0, speaker: "Maria", cls:"maria", text: "Great to know." },
    { t: 103.0, speaker: "Dave",  cls:"dave",  text: "Oh, actually, there was a burglary in that luxury boutique over there on the corner. They say the thieves stole over $300,000 worth of designer clothes." },
    { t: 116.0, speaker: "Maria", cls:"maria", text: "Wow, that‚Äôs crazy!" },
    { t: 119.0, speaker: "Dave",  cls:"dave",  text: "Yeah, that‚Äôs a typical Greenpoint crime I guess." },
    { t: 123.0, speaker: "Maria", cls:"maria", text: "Haha. I‚Äôm Maria by the way." },
    { t: 127.0, speaker: "Dave",  cls:"dave",  text: "Hi, I‚Äôm Dave, nice to meet you. Well, now that you got into your place, do you need help with anything else?" },
    { t: 137.0, speaker: "Maria", cls:"maria", text: "Thanks, nothing right now, but I know you‚Äôre just next door in apartment B if I ever need anything." },
    { t: 146.0, speaker: "Dave",  cls:"dave",  text: "Yup, I‚Äôll be here. Well, goodnight." }
  ];

  const el = document.getElementById("app");
  el.innerHTML = `
    <h1>Lesson 2 ‚Äî The Mix-Up</h1>
    <p class="sub">Audio first, optional transcript, then exercises.</p>

    <div class="card">
      <h2 style="margin:0 0 8px;font-size:18px;">Audio</h2>
      <audio id="${uid}_audio" controls preload="metadata">
        <source src="${mp3}" type="audio/mpeg" />
        Your browser can‚Äôt play this audio.
      </audio>

      <div class="controls">
        <button id="${uid}_show" type="button">Show dialogue</button>
        <button id="${uid}_hide" type="button" class="hidden">Hide dialogue</button>
        <button id="${uid}_full" type="button" class="hidden">Show full transcript</button>
      </div>

      <div id="${uid}_dlg" class="dialogueArea hidden" aria-live="polite"></div>
      <div class="note">Tip: click a revealed line to jump to that moment.</div>
    </div>

    <div class="card">
      <h2 style="margin:0 0 8px;font-size:18px;">1) Comprehension</h2>
      <p class="prompt"><strong>Why did Maria and Dave start talking about crime?</strong></p>
      <div class="options">
        <label><input type="radio" name="${uid}_crime" value="a"> Maria was trying to break into Dave‚Äôs apartment.</label>
        <label><input type="radio" name="${uid}_crime" value="b"> Maria wanted to know if the neighborhood was safe.</label>
        <label><input type="radio" name="${uid}_crime" value="c"> Someone had just stolen expensive clothes from a shop.</label>
        <label><input type="radio" name="${uid}_crime" value="d"> Maria thought the apartment she‚Äôs renting got robbed.</label>
      </div>
      <button id="${uid}_crime_check" type="button" style="margin-top:14px;">Check answer</button>
      <div id="${uid}_crime_fb" class="feedback" aria-live="polite"></div>
    </div>

    <div class="card">
      <h2 style="margin:0 0 8px;font-size:18px;">2) Match the crime</h2>
      <p class="prompt"><strong>Match the crime with its description.</strong></p>

      <div class="row" style="margin-top:10px;">
        <strong style="min-width:90px;">Burglary</strong>
        <select id="${uid}_m1">
          <option value="">Choose‚Ä¶</option>
          <option value="a">stealing from a home or business that involves breaking in</option>
          <option value="b">entering someone‚Äôs property illegally</option>
          <option value="c">stealing from someone in public, using threats or violence</option>
        </select>
      </div>

      <div class="row" style="margin-top:10px;">
        <strong style="min-width:90px;">Break in</strong>
        <select id="${uid}_m2">
          <option value="">Choose‚Ä¶</option>
          <option value="a">stealing from a home or business that involves breaking in</option>
          <option value="b">entering someone‚Äôs property illegally</option>
          <option value="c">stealing from someone in public, using threats or violence</option>
        </select>
      </div>

      <div class="row" style="margin-top:10px;">
        <strong style="min-width:90px;">Mugging</strong>
        <select id="${uid}_m3">
          <option value="">Choose‚Ä¶</option>
          <option value="a">stealing from a home or business that involves breaking in</option>
          <option value="b">entering someone‚Äôs property illegally</option>
          <option value="c">stealing from someone in public, using threats or violence</option>
        </select>
      </div>

      <button id="${uid}_match_check" type="button" style="margin-top:14px;">Check answers</button>
      <div id="${uid}_match_fb" class="feedback" aria-live="polite"></div>
    </div>

    <div class="card">
      <h2 style="margin:0 0 8px;font-size:18px;">3) break in / break into</h2>
      <p class="prompt"><strong>Choose the correct explanation.</strong></p>

      <div class="options">
        <label><input type="radio" name="${uid}_phrasal" value="a">
          <strong>break into</strong> + building (object). <strong>break in</strong> = no object.
        </label>
        <label><input type="radio" name="${uid}_phrasal" value="b">
          <strong>break in</strong> + building (object). <strong>break into</strong> = no object.
        </label>
        <label><input type="radio" name="${uid}_phrasal" value="c">
          They mean the same thing and are always interchangeable.
        </label>
      </div>

      <div class="note">
        Examples: ‚Äúbreak into my apartment‚Äù (object) vs ‚Äútrying to break in‚Äù (no object).
      </div>

      <button id="${uid}_phrasal_check" type="button" style="margin-top:14px;">Check answer</button>
      <div id="${uid}_phrasal_fb" class="feedback" aria-live="polite"></div>
    </div>

    <div class="card">
      <h2 style="margin:0 0 8px;font-size:18px;">4) Safe / Safety</h2>
      <p class="prompt"><strong>Choose the correct option.</strong></p>

      <div class="options">
        <label><input type="radio" name="${uid}_pos" value="a"> Safe / Safety is an adjective.</label>
        <label><input type="radio" name="${uid}_pos" value="b"> Safety / Safe is a noun.</label>
      </div>

      <button id="${uid}_pos_check" type="button" style="margin-top:14px;">Check answer</button>
      <div id="${uid}_pos_fb" class="feedback" aria-live="polite"></div>

      <div style="margin-top:14px;">
        <p class="prompt"><strong>Fill in the gap with <em>safe</em> or <em>safety</em>.</strong></p>
        <div class="row">
          <span>I never really feel</span>
          <input id="${uid}_g1" type="text" placeholder="safe / safety" autocomplete="off" />
          <span>in this neighborhood, especially at night.</span>
        </div>
        <div class="row" style="margin-top:10px;">
          <span>I can‚Äôt believe we had to sit through a two hour seminar on office</span>
          <input id="${uid}_g2" type="text" placeholder="safe / safety" autocomplete="off" />
          <span>today at work.</span>
        </div>

        <button id="${uid}_g_check" type="button" style="margin-top:14px;">Check answers</button>
        <div id="${uid}_g_fb" class="feedback" aria-live="polite"></div>
      </div>
    </div>
  `;

  /* -------- Transcript engine -------- */
  const audio = document.getElementById(`${uid}_audio`);
  const dlg = document.getElementById(`${uid}_dlg`);
  const showBtn = document.getElementById(`${uid}_show`);
  const hideBtn = document.getElementById(`${uid}_hide`);
  const fullBtn = document.getElementById(`${uid}_full`);

  let enabled = false, lastShown = -1, currentIdx = -1;

  const nodes = dialogueLines.map(line => {
    const div = document.createElement("div");
    div.className = `line ${line.cls}`;
    div.innerHTML = `<span class="speaker">${line.speaker}:</span><span>${line.text}</span>`;
    div.addEventListener("click", () => { audio.currentTime = T(line.t);
 audio.play(); });
    dlg.appendChild(div);
    return div;
  });

  function clearStates(){
    nodes.forEach(n => n.classList.remove("visible","past","current"));
    lastShown = -1; currentIdx = -1;
  }
  function setCurrent(idx){
    if (currentIdx === idx) return;
    if (currentIdx >= 0){ nodes[currentIdx].classList.remove("current"); nodes[currentIdx].classList.add("past"); }
    currentIdx = idx;
    nodes[currentIdx].classList.add("current","visible");
    nodes[currentIdx].classList.remove("past");
  }
  function revealUpTo(t){
    if (!enabled) return;
    while (lastShown + 1 < dialogueLines.length && T(dialogueLines[lastShown + 1].t) <= t + 0.05
){
      lastShown++;
      nodes[lastShown].classList.add("visible","past");
      nodes[lastShown].classList.remove("current");
    }
    let idx = -1;
    for (let i=0;i<dialogueLines.length;i++){ if (T(dialogueLines[i].t) <= t + 0.05) idx = i;
 else break; }
    if (idx >= 0 && idx <= lastShown) setCurrent(idx);
  }

  audio.addEventListener("timeupdate", () => revealUpTo(audio.currentTime));
  audio.addEventListener("seeked", () => { if (enabled) { clearStates(); revealUpTo(audio.currentTime); } });

  showBtn.addEventListener("click", () => {
    enabled = true;
    dlg.classList.remove("hidden");
    showBtn.classList.add("hidden");
    hideBtn.classList.remove("hidden");
    fullBtn.classList.remove("hidden");
    clearStates();
    revealUpTo(audio.currentTime);
  });

  hideBtn.addEventListener("click", () => {
    enabled = false;
    dlg.classList.add("hidden");
    showBtn.classList.remove("hidden");
    hideBtn.classList.add("hidden");
    fullBtn.classList.add("hidden");
    clearStates();
  });

  fullBtn.addEventListener("click", () => {
    if (!enabled) return;
    nodes.forEach(n => { n.classList.add("visible","past"); n.classList.remove("current"); });
    lastShown = nodes.length - 1; currentIdx = -1;
  });

  /* -------- Helpers -------- */
  const norm = s => (s||"").trim().toLowerCase().replace(/\s+/g," ").replace(/[.?!,;:()"']/g,"");

  /* -------- EX1: Comprehension (answer = b) -------- */
  const crimeFb = document.getElementById(`${uid}_crime_fb`);
  document.getElementById(`${uid}_crime_check`).addEventListener("click", () => {
    const sel = document.querySelector(`input[name="${uid}_crime"]:checked`);
    crimeFb.style.display = "block";
    if (!sel){ crimeFb.className = "feedback bad"; crimeFb.textContent = "Choose one option first üôÇ"; return; }
    if (sel.value === "b"){
      crimeFb.className = "feedback good";
      crimeFb.textContent = "‚úÖ Correct!";
    } else {
      crimeFb.className = "feedback bad";
      crimeFb.innerHTML = `‚ùå Not quite.<div class="note">Correct answer: <strong>Maria wanted to know if the neighborhood was safe.</strong></div>`;
    }
  });

  /* -------- EX2: Matching -------- */
  const matchFb = document.getElementById(`${uid}_match_fb`);
  document.getElementById(`${uid}_match_check`).addEventListener("click", () => {
    const m1 = document.getElementById(`${uid}_m1`);
    const m2 = document.getElementById(`${uid}_m2`);
    const m3 = document.getElementById(`${uid}_m3`);
    const ok = (m1.value==="a" && m2.value==="b" && m3.value==="c");

    matchFb.style.display = "block";
    if (!m1.value || !m2.value || !m3.value){
      matchFb.className = "feedback bad";
      matchFb.textContent = "Choose an option for each one üôÇ";
      return;
    }
    if (ok){
      matchFb.className = "feedback good";
      matchFb.textContent = "‚úÖ All correct!";
    } else {
      matchFb.className = "feedback bad";
      matchFb.innerHTML = `‚ùå Not quite.<div class="note">
        Correct matches:<br>
        <strong>Burglary</strong> ‚Üí stealing from a home or business that involves breaking in<br>
        <strong>Break in</strong> ‚Üí entering someone‚Äôs property illegally<br>
        <strong>Mugging</strong> ‚Üí stealing from someone in public, using threats or violence
      </div>`;
    }
  });

  /* -------- EX3: Phrasal verbs -------- */
  const phFb = document.getElementById(`${uid}_phrasal_fb`);
  document.getElementById(`${uid}_phrasal_check`).addEventListener("click", () => {
    const sel = document.querySelector(`input[name="${uid}_phrasal"]:checked`);
    phFb.style.display = "block";
    if (!sel){ phFb.className = "feedback bad"; phFb.textContent = "Choose one option first üôÇ"; return; }
    if (sel.value === "a"){
      phFb.className = "feedback good";
      phFb.textContent = "‚úÖ Correct!";
    } else {
      phFb.className = "feedback bad";
      phFb.innerHTML = `‚ùå Not quite.<div class="note">Correct: <strong>break into + building</strong> (object); <strong>break in</strong> (no object).</div>`;
    }
  });

  /* -------- EX4: Safe/Safety POS -------- */
  const posFb = document.getElementById(`${uid}_pos_fb`);
  document.getElementById(`${uid}_pos_check`).addEventListener("click", () => {
    const sel = document.querySelector(`input[name="${uid}_pos"]:checked`);
    posFb.style.display = "block";
    if (!sel){ posFb.className = "feedback bad"; posFb.textContent = "Choose one option first üôÇ"; return; }
    if (sel.value === "b"){
      posFb.className = "feedback good";
      posFb.textContent = "‚úÖ Correct! Safety is a noun; safe is an adjective.";
    } else {
      posFb.className = "feedback bad";
      posFb.innerHTML = `‚ùå Not quite.<div class="note">Correct: <strong>Safety</strong> is a noun; <strong>safe</strong> is an adjective.</div>`;
    }
  });

  /* -------- EX4b: Fill gaps -------- */
  const gFb = document.getElementById(`${uid}_g_fb`);
  document.getElementById(`${uid}_g_check`).addEventListener("click", () => {
    const g1 = document.getElementById(`${uid}_g1`);
    const g2 = document.getElementById(`${uid}_g2`);
    const a1 = norm(g1.value), a2 = norm(g2.value);

    gFb.style.display = "block";

    let ok1 = (a1 === "safe"), ok2 = (a2 === "safety");
    g1.style.borderColor = ok1 ? "#7cc47c" : "#e07a7a";
    g2.style.borderColor = ok2 ? "#7cc47c" : "#e07a7a";

    if (!a1 || !a2){
      gFb.className = "feedback bad";
      gFb.textContent = "Fill in both gaps first üôÇ";
      return;
    }

    if (ok1 && ok2){
      gFb.className = "feedback good";
      gFb.textContent = "‚úÖ Correct!";
    } else {
      gFb.className = "feedback bad";
      gFb.innerHTML = `‚ùå Not quite.<div class="note">Answers: <strong>safe</strong> (1), <strong>safety</strong> (2).</div>`;
    }
  });
})();
</script>
</body>
</html>
